{% extends 'base.html' %}

{% block title %}Dynamic Calendar with Streak{% endblock %}

{% block content %}
<style>
    .center {
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
    }
    header {
        padding: 10px;
        text-align: center;
        border-radius: 8px; /* Abgerundete Ecken */
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Weicher Schatten */
        margin-bottom: 0px; /* Verkleinert den Abstand nach unten */
    }

    header h1 {
        font-family: 'Arial', sans-serif;
        font-size: 2.5rem;
        color: #4CAF50; /* Grün für eine frische Optik */
        margin-bottom: 10px;
    }

    #calorie-info {
        font-family: 'Arial', sans-serif;
        font-size: 1.2rem;
        color: #ffffff; /* Dunkler Text */
        margin-bottom: 20px;
    }

    #remaining-calories {
        font-family: 'Courier New', monospace;
        font-size: 1.5rem;
        color: #ffffff; /* Orange für die Kalorienzahl */
        font-weight: bold;
    }

    #macro-info {
        display: flex;
        justify-content: center;
        gap: 20px;
        font-family: 'Arial', sans-serif;
        font-size: 1rem;
        color: #ffffff; /* Neutrale Farbe für den Text */
    }

    .macro-group {
        text-align: center;
    }

    .macro-group label {
        display: block;
        font-weight: bold;
        margin-bottom: 5px;
        color: #ffffff;
    }

    .macro-group span {
        font-size: 1.2rem;
        color: #ffffff; /* Blau für Makronährstoffzahlen */
        font-weight: bold;
    }
    
    
    #calorie-form {
        margin-top: 0; /* Entfernt zusätzlichen Abstand zum Header */
    }
    .button-group button {
        margin: 5px;
        padding: 10px 20px;
        border: 1px solid #ddd;
        background-color: #40433f; /* Dunkleres Grau für bessere Lesbarkeit */
        color: #d1d1c7; /* Schriftfarbe leichtes Grau */
        cursor: pointer;
        border-radius: 5px;
        transition: background-color 0.3s, color 0.3s; /* Weicher Übergang */
    }

    .button-group button:hover {
        background-color: #4a6b4f; /* Leichtes Grün beim Hover */
        color: white; /* Bessere Sichtbarkeit */
    }

    .button-group button.active {
        background-color: #4CAF50; /* Grün für ausgewählte Buttons */
        color: white; /* Weiße Schrift für Kontrast */
        border: 1px solid #4CAF50;
    }
</style>
    <header>
        <h1>Kalorien Tracker</h1>
        <p id="calorie-info">
            <span>Ihr täglicher Kalorienbedarf:</span>
            <span id="remaining-calories" style="font-family: 'Courier New', monospace; font-size: 1.5rem;">-</span> kcal
        </p>

        <p id="macro-info">

            <div class="macro-group">
                <label class="label">Kohlenhydrate:</label>
                <span id="daily-carb"></span>g
            </div>
            <div class="macro-group">
                <label class="label">Proteine:</label>
                <span id="daily-protein"></span>g
            </div>
            <div class="macro-group">
                <label class="label">Fette:</label>
                <span id="daily-fat"></span>g
            </div>

        </p>

    </header>
    <div id="calorie-form" class="center">
        <form id="user-form">
            <h2>Berechnen Sie Ihren täglichen Kalorienbedarf</h2>
            
            <!-- Geschlecht -->
            <label>Geschlecht:</label>
            <div id="gender-buttons" class="button-group">
                <button type="button" data-value="male">Männlich</button>
                <button type="button" data-value="female">Weiblich</button>
            </div>

            <!-- Aktivität -->
            <label>Tägliche Aktivität:</label>
            <div id="activity-buttons" class="button-group">
                <button type="button" data-value="1.2">Wenig oder keine Bewegung</button>
                <button type="button" data-value="1.375">Leicht aktiv</button>
                <button type="button" data-value="1.55">Moderat aktiv</button>
                <button type="button" data-value="1.725">Sehr aktiv</button>
                <button type="button" data-value="1.9">Extrem aktiv</button>
            </div>

            <!-- Ziel -->
            <label>Ziel:</label>
            <div id="goal-buttons" class="button-group">
                <button type="button" data-value="lose">Abnehmen</button>
                <button type="button" data-value="maintain">Gewicht halten</button>
                <button type="button" data-value="gain">Zunehmen</button>
            </div>

        
            <label for="weight">Wie schwer sind Sie? (in kg)</label>
            <input type="number" id="weight" placeholder="z. B. 70" required>
            <label for="age">Wie alt sind Sie? (in Jahren)</label>
            <input type="number" id="age" placeholder="z. B. 25" required>
            <label for="height">Wie groß sind Sie? (in cm)</label>
            <input type="number" id="height" placeholder="z. B. 175" required>
            <button type="submit">Kalorienbedarf berechnen</button>
        </form>
    </div>

<script>
        let dailyCalories = 0; // Täglicher Kalorienbedarf
        let consumedCalories = 0; // Kalorien bereits konsumiert

        const userForm = document.getElementById('user-form');
        const calorieForm = document.getElementById('calorie-form');
        const calorieInfo = document.getElementById('calorie-info');
        const remainingCalories = document.getElementById('remaining-calories');
        const foodForm = document.getElementById('food-form');
        const foodList = document.getElementById('food-list');
        const totalConsumed = document.getElementById('total-consumed');
        const mainContent = document.querySelector('main');
        const header = document.querySelector('header');

        const showCalorieFormButton = document.querySelector('.kalorienrechner');

        // Auswahl der Buttons vorbereiten
        let selectedGender = null;
        let selectedActivity = null;
        let selectedGoal = null;

        setupButtonGroup('gender-buttons', value => {
            selectedGender = value;
        });
        setupButtonGroup('activity-buttons', value => {
            selectedActivity = parseFloat(value);
        });
        setupButtonGroup('goal-buttons', value => {
            selectedGoal = value;
        });

        // Hilfsfunktion zur Aktivierung der Buttons
        function setupButtonGroup(groupId, callback) {
            const buttons = document.querySelectorAll(`#${groupId} button`);
            buttons.forEach(button => {
                button.addEventListener('click', () => {
                    buttons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    callback(button.getAttribute('data-value'));
                });
            });
        }
  
  // Benutzerformular zur Berechnung des Kalorienbedarfs
    userForm.addEventListener('submit', function (event) {
            event.preventDefault();

            const weight = parseFloat(document.getElementById('weight').value);
            const age = parseFloat(document.getElementById('age').value);
            const height = parseFloat(document.getElementById('height').value);
            // Geschlecht, Aktivitätslevel und Ziel aus den ausgewählten Radio-Buttons holen
            const gender = document.querySelector('input[name="gender"]:checked')?.value;
            const activity = parseFloat(document.querySelector('input[name="activity"]:checked')?.value);
            const goal = document.querySelector('input[name="goal"]:checked')?.value;


            if (weight && age && height && selectedGender && selectedActivity && selectedGoal) {
                // Berechnung des Grundumsatzes (BMR)
                let bmr = selectedGender === 'male'
                    ? 10 * weight + 6.25 * height - 5 * age + 5
                    : 10 * weight + 6.25 * height - 5 * age - 161;

                // Aktivitätslevel berücksichtigen
                let totalCalories = bmr * selectedActivity;

                // Ziel anpassen
                if (selectedGoal === 'lose') totalCalories -= 300; // Abnehmen
                if (selectedGoal === 'gain') totalCalories += 300; // Zunehmen

                dailyCalories = Math.round(totalCalories);
                remainingCalories.textContent = dailyCalories;

                // Makronährstoffe berechnen
                const carbCalories = dailyCalories * 0.50; // 50% der Kalorien
                const proteinCalories = dailyCalories * 0.20; // 20% der Kalorien
                const fatCalories = dailyCalories * 0.30; // 30% der Kalorien

                // In Gramm umrechnen
                const carbGrams = Math.round(carbCalories / 4); // 1 g Kohlenhydrate = 4 kcal
                const proteinGrams = Math.round(proteinCalories / 4); // 1 g Proteine = 4 kcal
                const fatGrams = Math.round(fatCalories / 9); // 1 g Fett = 9 kcal

                document.getElementById('daily-carb').textContent = carbGrams;
                document.getElementById('daily-protein').textContent = proteinGrams;
                document.getElementById('daily-fat').textContent = fatGrams;


            } else {
                alert("Bitte geben Sie gültige Werte ein.");
            }
    });  
</script>
{% endblock %}
