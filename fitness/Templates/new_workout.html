<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workout Unit hinzufügen</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        label { margin-top: 10px; display: block; }
        input, select, button { margin-top: 5px; width: 300px; }
    </style>
</head>
<body>
    <h1>Workout Unit erstellen</h1>
    <form method="POST" action="{% url 'save_workout_unit' %}">
        {% csrf_token %}
        <label for="workoutClassDropdown">Workout-Klasse auswählen:</label>
        <select id="workoutClassDropdown">
            <option value="">-- Wähle eine Workout-Klasse --</option>
        </select>

        <label for="workoutTypeDropdown" style="display: none;">Workout-Typ auswählen:</label>
        <select id="workoutTypeDropdown" style="display: none;">
            <option value="">-- Wähle einen Workout-Typ --</option>
        </select>

        <label for="weightInput" style="display: none;">Gewicht (kg):</label>
        <input type="number" id="weightInput" step="0.1" style="display: none;">

        <label for="workoutLengthInput" style="display: none;">Workout-Länge (Minuten):</label>
        <input type="number" id="workoutLengthInput" style="display: none;">
        
        <button id="saveButton" style="display: none;" type="submit">Workout speichern</button>

    <div id="responseMessage" style="margin-top: 20px; color: green;"></div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const workoutClassDropdown = document.getElementById('workoutClassDropdown');
            const workoutTypeDropdown = document.getElementById('workoutTypeDropdown');
            const weightInput = document.getElementById('weightInput');
            const workoutLengthInput = document.getElementById('workoutLengthInput');
            const saveButton = document.getElementById('saveButton');
            const responseMessage = document.getElementById('responseMessage');

            // Workout-Klassen laden
            fetch('/fitness/get_workout_classes/')
                .then(response => response.json())
                .then(data => {
                    data.results.forEach(workoutClass => {
                        const option = document.createElement('option');
                        option.value = workoutClass.id;
                        option.textContent = workoutClass.name;
                        workoutClassDropdown.appendChild(option);
                    });
                });

            // Workout-Typen basierend auf der ausgewählten Klasse laden
            workoutClassDropdown.addEventListener('change', function () {
                const workoutClassId = this.value;
                workoutTypeDropdown.style.display = workoutClassId ? 'block' : 'none';
                workoutTypeDropdown.innerHTML = '<option value="">-- Wähle einen Workout-Typ --</option>';
                if (workoutClassId) {
                    fetch(`/fitness/get_workout_types?workout_class_id=${workoutClassId}`)
                        .then(response => response.json())
                        .then(data => {
                            data.results.forEach(workoutType => {
                                const option = document.createElement('option');
                                option.value = workoutType.id;
                                option.textContent = workoutType.name;
                                workoutTypeDropdown.appendChild(option);
                            });
                        });
                }
            });

            // Zusätzliche Felder anzeigen, wenn ein Workout-Typ gewählt wurde
            workoutTypeDropdown.addEventListener('change', function () {
                const workoutTypeId = this.value;
                const showInputs = !!workoutTypeId;
                weightInput.style.display = showInputs ? 'block' : 'none';
                workoutLengthInput.style.display = showInputs ? 'block' : 'none';
                saveButton.style.display = showInputs ? 'block' : 'none';
            });

            // Workout speichern
            saveButton.addEventListener('click', function () {
                const workoutClassId = workoutClassDropdown.value;
                console.log("Selected Workout Class ID:", workoutClassId);
                if (!workoutClassId) {
                    alert("Bitte eine Workout-Klasse auswählen.");
                    return;  // Abbrechen, wenn keine Klasse ausgewählt wurde
                }
                const workoutTypeId = workoutTypeDropdown.value;
                const weight = weightInput.value;
                const workoutLength = workoutLengthInput.value;

                console.log("workout_class_id:", workoutClassId);
                console.log("workout_type_id:", workoutTypeId);
                console.log("weight:", weight);
                console.log("workout_length:", workoutLength);

                fetch('/fitness/save_workout_unit/', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' , 'X-CSRFToken': csrfToken},
                    body: new URLSearchParams({
                        workout_class_id: workoutClassId,
                        workout_type_id: workoutTypeId,
                        weight: weight,
                        workout_length: workoutLength
                    })
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.status === 'success') {
                            responseMessage.textContent = 'Workout erfolgreich gespeichert!';
                        } else {
                            responseMessage.textContent = `Fehler: ${data.message}`;
                        }
                    });
            });
        });
    </script>
</body>
</html>